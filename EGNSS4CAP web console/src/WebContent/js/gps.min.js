/*
GPS.js v0.5.2 26/01/2016

Copyright (c) 2016, Robert Eisele (robert@xarg.org)
Dual licensed under the MIT or GPL Version 2 licenses.
*/
(function(t){function f(b,a){if(""===b)return null;var g=new Date;if(a){var d=a.slice(4),c=a.slice(2,4)-1,e=a.slice(0,2);4===d.length?g.setUTCFullYear(Number(d),Number(c),Number(e)):g.setUTCFullYear(Number("20"+d),Number(c),Number(e))}g.setUTCHours(Number(b.slice(0,2)));g.setUTCMinutes(Number(b.slice(2,4)));g.setUTCSeconds(Number(b.slice(4,6)));d=b.slice(7);c=d.length;e=0;0!==c&&(e=parseFloat(d)*Math.pow(10,3-c));g.setUTCMilliseconds(Number(e));return g}function h(b,a){if(""===b)return null;var c=
1;switch(a){case "S":c=-1;case "N":var d=2;break;case "W":c=-1;case "E":d=3}return c*(parseFloat(b.slice(0,d))+parseFloat(b.slice(d))/60)}function c(b){return""===b?null:parseFloat(b)}function p(b){return""===b?null:1.852*parseFloat(b)}function u(b){if(""===b)return null;switch(parseInt(b,10)){case 0:return null;case 1:return"fix";case 2:return"dgps-fix";case 3:return"pps-fix";case 4:return"rtk";case 5:return"rtk-float";case 6:return"estimated";case 7:return"manual";case 8:return"simulated"}throw Error("INVALID GGA FIX: "+
b);}function q(b){switch(b){case "A":return"active";case "V":return"void";case "":return null}throw Error("INVALID RMC/GLL STATUS: "+b);}function l(b){switch(b){case "":return null;case "A":return"autonomous";case "D":return"differential";case "E":return"estimated";case "M":return"manual input";case "S":return"simulated";case "N":return"not valid";case "P":return"precise";case "R":return"rtk";case "F":return"rtk-float"}throw Error("INVALID FAA MODE: "+b);}function r(b,a){if("M"===a||""===a)return c(b);
throw Error("Unknown unit: "+a);}function e(){if(!(this instanceof e))return new e;this.events={};this.state={errors:0,processed:0}}var k=Math.PI/180,m=[];e.prototype.events=null;e.prototype.state=null;e.mod={GGA:function(b,a){if(16!==a.length)throw Error("Invalid GGA length: "+b);return{time:f(a[1]),lat:h(a[2],a[3]),lon:h(a[4],a[5]),alt:r(a[9],a[10]),quality:u(a[6]),satellites:c(a[7]),hdop:c(a[8]),geoidal:r(a[11],a[12]),age:c(a[13]),stationID:c(a[14])}},GSA:function(b,a){if(19!==a.length&&20!==a.length)throw Error("Invalid GSA length: "+
b);for(var g=[],d=3;15>d;d++)""!==a[d]&&g.push(parseInt(a[d],10));a:{d=a[1];switch(d){case "M":d="manual";break a;case "A":d="automatic";break a;case "":d=null;break a}throw Error("INVALID GSA MODE: "+d);}a:{var e=a[2];switch(e){case "1":case "":e=null;break a;case "2":e="2D";break a;case "3":e="3D";break a}throw Error("INVALID GSA FIX: "+e);}return{mode:d,fix:e,satellites:g,pdop:c(a[15]),hdop:c(a[16]),vdop:c(a[17]),systemId:19<a.length?c(a[18]):null}},RMC:function(b,a){if(13!==a.length&&14!==a.length&&
15!==a.length)throw Error("Invalid RMC length: "+b);var g=f(a[1],a[9]),d=q(a[2]),e=a[10],n=a[11];return{time:g,status:d,lat:h(a[3],a[4]),lon:h(a[5],a[6]),speed:p(a[7]),track:c(a[8]),variation:""===e||""===n?null:parseFloat(e)*("W"===n?-1:1),faa:13<a.length?l(a[12]):null,navStatus:14<a.length?a[13]:null}},VTG:function(b,a){if(10!==a.length&&11!==a.length)throw Error("Invalid VTG length: "+b);if(""===a[2]&&""===a[8]&&""===a[6])return{track:null,trackMagetic:null,speed:null,faa:null};if("T"!==a[2])throw Error("Invalid VTG track mode: "+
b);if("K"!==a[8]||"N"!==a[6])throw Error("Invalid VTG speed tag: "+b);return{track:c(a[1]),trackMagnetic:""===a[3]?null:c(a[3]),speed:p(a[5]),faa:11===a.length?l(a[9]):null}},GSV:function(b,a){if(0===a.length%4%3)throw Error("Invalid GSV length: "+b);for(var g=[],d=4;d<a.length-3;d+=4){var e=c(a[d]),f=c(a[d+3]);g.push({prn:e,elevation:c(a[d+1]),azimuth:c(a[d+2]),snr:f,status:null!==e?null!==f?"tracking":"in view":null})}return{msgNumber:c(a[2]),msgsTotal:c(a[1]),satellites:g,signalId:2===a.length%
4?c(a[a.length-2]):null}},GLL:function(b,a){if(9!==a.length&&8!==a.length)throw Error("Invalid GLL length: "+b);return{time:f(a[5]),status:q(a[6]),lat:h(a[1],a[2]),lon:h(a[3],a[4]),faa:9===a.length?l(a[7]):null}},ZDA:function(b,a){return{time:f(a[1],a[2]+a[3]+a[4])}},GST:function(b,a){if(10!==a.length)throw Error("Invalid GST length: "+b);return{time:f(a[1]),rms:c(a[2]),ellipseMajor:c(a[3]),ellipseMinor:c(a[4]),ellipseOrientation:c(a[5]),latitudeError:c(a[6]),longitudeError:c(a[7]),heightError:c(a[8])}},
HDT:function(b,a){if(4!==a.length)throw Error("Invalid HDT length: "+b);return{heading:parseFloat(a[1]),trueNorth:"T"===a[2]}},GRS:function(b,a){if(18!==a.length)throw Error("Invalid GRS length: "+b);for(var g=[],d=3;14>=d;d++){var e=c(a[d]);null!==e&&g.push(e)}return{time:f(a[1]),mode:c(a[2]),res:g}},GBS:function(b,a){if(10!==a.length&&12!==a.length)throw Error("Invalid GBS length: "+b);return{time:f(a[1]),errLat:c(a[2]),errLon:c(a[3]),errAlt:c(a[4]),failedSat:c(a[5]),probFailedSat:c(a[6]),biasFailedSat:c(a[7]),
stdFailedSat:c(a[8]),systemId:12===a.length?c(a[9]):null,signalId:12===a.length?c(a[10]):null}},GNS:function(b,a){if(14!==a.length&&15!==a.length)throw Error("Invalid GNS length: "+b);return{time:f(a[1]),lat:h(a[2],a[3]),lon:h(a[4],a[5]),mode:a[6],satsUsed:c(a[7]),hdop:c(a[8]),alt:c(a[9]),sep:c(a[10]),diffAge:c(a[11]),diffStation:c(a[12]),navStatus:15===a.length?a[13]:null}}};e.Parse=function(b){if("string"!==typeof b)return!1;var a=b.split(","),c=a.pop();if(2>a.length||"$"!==b.charAt(0)||-1===c.indexOf("*"))return!1;
c=c.split("*");a.push(c[0]);a.push(c[1]);a[0]=a[0].slice(3);if(void 0!==e.mod[a[0]]){c=this.mod[a[0]](b,a);c.raw=b;for(var d=0,f=1;f<b.length;f++){var h=b.charCodeAt(f);if(42===h)break;d^=h}c.valid=d===parseInt(a[a.length-1],16);c.type=a[0];return c}return!1};e.Heading=function(b,a,c,d){a=(d-a)*k;b*=k;c*=k;d=Math.cos(c);return(180*Math.atan2(Math.sin(a)*d,Math.cos(b)*Math.sin(c)-Math.sin(b)*d*Math.cos(a))/Math.PI+360)%360};e.Distance=function(b,a,c,d){var e=(c-b)*k*.5;a=(d-a)*k*.5;b*=k;c*=k;e=Math.sin(e);
a=Math.sin(a);return 12745.6*Math.asin(Math.sqrt(e*e+Math.cos(b)*Math.cos(c)*a*a))};e.TotalDistance=function(b){if(2>b.length)return 0;for(var a=0,c=0;c<b.length-1;c++){var d=b[c],f=b[c+1];a+=e.Distance(d.lat,d.lon,f.lat,f.lon)}return a};e.prototype.update=function(b){b=e.Parse(b);this.state.processed++;if(!1===b)return this.state.errors++,!1;var a=this.state;if("RMC"===b.type||"GGA"===b.type||"GLL"===b.type||"GNS"===b.type)a.time=b.time,a.lat=b.lat,a.lon=b.lon;"ZDA"===b.type&&(a.time=b.time);"GGA"===
b.type&&(a.alt=b.alt);"RMC"===b.type&&(a.speed=b.speed,a.track=b.track);"GSA"===b.type&&(a.satsActive=b.satellites,a.fix=b.fix,a.hdop=b.hdop,a.pdop=b.pdop,a.vdop=b.vdop);if("GSV"===b.type){for(var c=b.satellites,d=0;d<c.length;d++)m.push(c[d]);b.msgNumber===b.msgsTotal&&(a.satsVisible=m,m=[])}this.emit("data",b);this.emit(b.type,b);return!0};e.prototype.partial="";e.prototype.updatePartial=function(b){for(this.partial+=b;;){b=this.partial.indexOf("\r\n");if(-1===b)break;var a=this.partial.slice(0,
b);"$"===a.charAt(0)&&this.update(a);this.partial=this.partial.slice(b+2)}};e.prototype.on=function(b,a){return void 0===this.events[b]?(this.events[b]=a,this):null};e.prototype.off=function(b){void 0!==this.events[b]&&(this.events[b]=void 0);return this};e.prototype.emit=function(b,a){void 0!==this.events[b]&&this.events[b].call(this,a)};"object"===typeof exports?(Object.defineProperty(exports,"__esModule",{value:!0}),e["default"]=e,e.GPS=e,module.exports=e):t.GPS=e})(this);